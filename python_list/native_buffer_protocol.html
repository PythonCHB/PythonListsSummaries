

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Native object exposing buffer protocol &mdash; Python List Summaries 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python Inheritance Terminology" href="inheritance_terminology.html" />
    <link rel="prev" title="Python-list" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Python List Summaries
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../python_ideas/index.html">Python-ideas</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python-list</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Native object exposing buffer protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#responses">Responses</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">1.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">2.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#author">3. author</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">4.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="inheritance_terminology.html">Python Inheritance Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="why_does___ne___exist.html">Why does <code class="docutils literal notranslate"><span class="pre">__ne__</span></code> exist?</a></li>
<li class="toctree-l2"><a class="reference internal" href="where_did_csv_parser_go.html">Where did csv.parser() go?</a></li>
<li class="toctree-l2"><a class="reference internal" href="purpose_of___version___in_std_library.html">What is the purpose of <code class="docutils literal notranslate"><span class="pre">__version__</span></code> in the standard library?</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Python List Summaries</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Python-list</a> &raquo;</li>
        
      <li>Native object exposing buffer protocol</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/python_list/native_buffer_protocol.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>NOTE: this page needs cleanign up and formatting in rst</p>
<div class="section" id="native-object-exposing-buffer-protocol">
<h1>Native object exposing buffer protocol<a class="headerlink" href="#native-object-exposing-buffer-protocol" title="Permalink to this headline">¶</a></h1>
<p>[<a class="reference external" href="https://mail.python.org/pipermail/python-list/2018-January/729896.html](https://mail.python.org/pipermail/python-list/2018-January/729896.html">https://mail.python.org/pipermail/python-list/2018-January/729896.html](https://mail.python.org/pipermail/python-list/2018-January/729896.html</a>)</p>
<p>I’d like to create a native Python object that exposes the buffer
protocol.  Basically, something with a <code class="docutils literal notranslate"><span class="pre">`._data</span> <span class="pre">member`</span></code> which is a
bytearray that I can still read into, make directly into a numpy array, etc.</p>
<p>I can do it by inheriting the entire thing from bytearray directly, but
that gives me a whole lot of methods that are unsuitable for what I’m
doing with it, which is reading the contents of a binary file, allowing
them to be lightly malleable in memory, and then sending them on to a
device.</p>
<p>Not the end of the world (the file’s less than 2KB), but it seems like
something that should be doable easily without having to throw around a
lot of extraneous copies.</p>
<div class="section" id="responses">
<h2>Responses<a class="headerlink" href="#responses" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>1.<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Could you use memoryviews instead of making the copies?</p>
</div>
<div class="section" id="id2">
<h3>2.<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>&gt; I’d like to create a native Python object that exposes the buffer
&gt; protocol.  Basically, something with a ._data member which is a
bytearray that I can still readinto, make directly into a numpy array,
etc.</div></blockquote>
<p>The “etc.” seems pretty important, there. You want the behaviour of
‘bytearray’ without actually inheriting that behaviour from the
‘bytearray’ type.</p>
<p>So, it seems your options are:</p>
<ul class="simple">
<li>Enumerate all the things, specifically, that you do want your new type
to do. Don’t hide anything in “etc.”, so that you know exactly what
behaviours need to be implemented. Implement all those behaviours,
without benefit of inheriting from <code class="docutils literal notranslate"><span class="pre">bytearray</span></code>.</li>
<li>Inherit from <code class="docutils literal notranslate"><span class="pre">bytearray</span></code>, but ameliorate the problems you want to
avoid. This will require enumerating all those problems, so that you
can know whether you have avoided them. Don’t hide any of them in an
“etc.”.</li>
</ul>
<p>&gt; Not the end of the world (the file’s less than 2KB), but it seems like
&gt; something that should be doable easily without having to throw around
&gt; a lot of extraneous copies.</p>
<p>I look forward to your report from having tried it :-)</p>
</div>
<div class="section" id="author">
<h3>3. author<a class="headerlink" href="#author" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>The “etc.” seems pretty important, there. You want the behaviour of
‘bytearray’ without actually inheriting that behaviour from the
‘bytearray’ type. &gt;</div></blockquote>
<p>Well, one specific behavior.  Ideally, what I want is, when calls like
RawIOBase.readinto and ndarray.frombuffer ask my class “Hey, do you have
any raw bytes that I can read and potentially write?” it can answer “Why
certainly, here they are.”  Something like a:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Thingy</span><span class="p">:</span>
   <span class="k">def</span> <span class="nf">__memoryview__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">memoryview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</pre></div>
</div>
<p>But it doesn’t look as if there’s a dunder for that.  There’s <code class="docutils literal notranslate"><span class="pre">__bytes__</span></code>, but that specifically requires you give back a bytes() object; even
returning a bytearray causes an error.</p>
<p>&gt; So, it seems your options are:
&gt;
&gt; * Enumerate all the things, specifically, that you do want your new type
&gt;    to do. Don’t hide anything in “etc.”, so that you know exactly what
&gt;    behaviours need to be implemented. Implement all those behaviours,
&gt;    without benefit of inheriting from ‘bytearray’.
&gt;
&gt; * Inherit from ‘bytearray’, but ameliorate the problems you want to
&gt;    avoid. This will require enumerating all those problems, so that you
&gt;    can know whether you have avoided them. Don’t hide any of them in an
&gt;    “etc.”.</p>
<p>That’s ultimately the way I’m going about it, but since this is only
going to get used in-house, I’m approaching it the Pythonic way.  The
problem is “Most methods of bytearray make no sense on a data structure
representing a fixed length waveform.”  The solution is “Well, don’t use
them.”</p>
</div>
<div class="section" id="id3">
<h3>4.<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Curiosity having got the better of me I did some searching and found this “Implementing the buffer protocol” (<a class="reference external" href="http://cython.readthedocs.io/en/latest/src/userguide/buffer.html">http://cython.readthedocs.io/en/latest/src/userguide/buffer.html</a>), any use to you?  Note that at the bottom of the link the final section “References” states “The buffer interface used here is set out in PEP 3118, Revising the buffer protocol.”, i.e. it is the new protocol and not the old Python 2 one.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="inheritance_terminology.html" class="btn btn-neutral float-right" title="Python Inheritance Terminology" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Python-list" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Christopher Barker and Community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>